# 未来投資型タスク管理アプリ

「目の前の忙しさ」に埋没せず、「未来の売上（種まき）」を確実に実行するためのタスク管理ツール。

## 🎯 プロジェクト概要

- **名前**: 未来投資型タスク管理
- **目的**: スプレッドシート管理の煩わしさを解消し、直感的なUIで期限管理と優先順位付けを行う
- **最大の特徴**:
  - タスクを「4つの役割」に分類し、色で直感的に識別
  - 「期日が近い（3日以内）」タスクを視覚的に警告
  - Googleカレンダーとの連携で予定からタスクを自動生成

## 🌐 デモURL

- **開発環境**: `localhost:3000`（ローカル開発）
- **GitHub**: https://github.com/tatsuki0422-ai/task_kanri
- **本番環境**: （Cloudflare Pagesへデプロイ後に追加）

## ✨ 主な機能

### ✅ 完成した機能

1. **タスク管理のコア機能**
   - タスクの作成・更新・削除
   - 4つのカテゴリ分類（未来/直近/維持/雑務）
   - 3段階の優先度設定（高/中/低）
   - 想定時間の設定（分単位）
   - 期日の設定と管理

2. **期限アラート機能**
   - 3日以内のタスク：背景が赤色、脈動アニメーション、「⚡ あと〇日」表示
   - 当日のタスク：「🔥 今日まで」表示
   - 期限切れのタスク：「⚠️ 〇日遅れ」表示

3. **🆕 本日の予定表自動生成機能**
   - **押下時刻の表示**：ボタンを押した時刻とランチ予定時刻を表示（例：「12時46分に押下 → ランチは18時46分頃を予定」）
   - **Googleカレンダー自動取得**：「カレンダーから取得」ボタンで今日の固定予定を自動取得
   - **食事時間の自動配置**：ランチ（押下時刻+6時間）と夜ご飯（20:00〜24:00）を自動挿入
   - **固定予定の設定**：会食・打合せ・移動などを手動追加も可能
   - **返信枠の自動配置**：3時間ごとに15分の返信時間を確保
   - **家族時間の確保**：20:00〜24:00を家族ブロックとして設定
   - **タスクの最適配置**：深い作業（45-90分）と軽作業（15-30分）を空き時間に自動配置
   - **衝突回避ロジック**：
     - ランチ：後ろに最大+90分、前に最大-180分スライド（20時以降禁止）
     - 夜ご飯：20:00〜24:00の間で60分枠を探索（21:00〜22:00を優先）
   - **15分刻みの精密スケジューリング**

4. **Googleカレンダー連携**
   - カレンダーから今後7日間の予定を取得
   - カレンダーイベントをワンクリックでタスクに変換
   - REST APIベースの統合

5. **レスポンシブUI**
   - PC/スマホ対応のモダンなデザイン
   - Tailwind CSSによる美しいUI
   - カテゴリごとの色分けボーダー
   - 直感的な操作性

### 🚧 未実装の機能

- Googleカレンダーからの自動タスク生成（現在は手動変換のみ）
- タスクの並び替え機能
- フィルター・検索機能
- 統計・レポート機能

## 🗄️ データ構造

### データベース: Cloudflare D1 (SQLite)

**tasksテーブル**
| 列 | 型 | 説明 |
|---|---|---|
| id | TEXT | タスクID（UUID） |
| title | TEXT | タスク名 |
| category | TEXT | カテゴリ（future/now/maintain/chore） |
| minutes | INTEGER | 想定時間（分） |
| status | TEXT | ステータス（todo/done/deleted） |
| created_at | TEXT | 作成日時 |
| due_date | TEXT | 期日（YYYY-MM-DD） |
| priority | TEXT | 優先度（high/medium/low） |

**calendar_eventsテーブル**（将来の拡張用）
| 列 | 型 | 説明 |
|---|---|---|
| id | TEXT | イベントID |
| summary | TEXT | イベント名 |
| description | TEXT | 説明 |
| start_time | TEXT | 開始時刻 |
| end_time | TEXT | 終了時刻 |
| synced_at | TEXT | 同期日時 |
| converted_to_task | INTEGER | タスク変換済みフラグ |

## 🚀 APIエンドポイント

### タスク管理
- `GET /api/tasks` - タスク一覧取得
- `GET /api/tasks/:id` - タスク詳細取得
- `POST /api/tasks` - タスク作成
- `PUT /api/tasks/:id` - タスク更新
- `DELETE /api/tasks/:id` - タスク削除（ソフトデリート）
- `POST /api/tasks/:id/toggle` - タスク完了/未完了の切り替え

### Googleカレンダー連携
- `GET /api/calendar/events` - カレンダーイベント取得
- `POST /api/calendar/convert` - イベントをタスクに変換

### 🆕 予定表生成
- `POST /api/schedule/generate` - 本日の予定表を自動生成
- `GET /api/calendar/today` - 今日のカレンダー予定を取得（固定予定用）

## 📱 使い方

1. **タスクの追加**
   - タスク名、カテゴリ、優先度、期日、時間を入力
   - 「タスクを追加」ボタンをクリック

2. **タスクの完了**
   - タスクの左側の◯ボタンをクリック
   - 完了したタスクは取り消し線が付きグレーアウト

3. **タスクの削除**
   - タスクの右側のゴミ箱アイコンをクリック
   - 確認ダイアログが表示されます

4. **🆕 本日の予定表を自動生成**
   - **「カレンダーから取得」ボタンをクリック**（推奨）
     - Googleカレンダーから今日の固定予定を自動取得
     - 会食・打合せ・移動などが自動で読み込まれます
   - または手動で固定予定を追加：
     - 開始時刻・終了時刻・予定名を入力して「+」ボタン
   - **「予定表を生成」ボタンをクリック**
   - 押下時刻が表示されます（例：「12時46分に押下 → ランチは18時46分頃を予定」）
   - 以下が自動で配置されます：
     - ランチ（押下時刻+6時間、60分）
     - 夜ご飯（20:00〜24:00の間で60分）
     - 返信枠（3時間ごとに15分）
     - 家族時間（20:00〜24:00）
     - タスク（優先度順に空き時間へ配置）

5. **Googleカレンダーとの連携**
   - 「予定を取得」ボタンをクリック
   - 表示された予定の「タスク化」ボタンをクリック
   - ⚠️ 初回は環境変数の設定が必要です
   - 👉 **[環境変数の安全な設定方法はこちら](ENV_SETUP.md)**

## 🔧 予定表生成のルール

### ランチの配置ルール
- **基本**: 押下時刻 + 6時間（15分刻みに切り上げ）
- **長さ**: 60分
- **制限**: 20:00以降には配置しない
- **衝突時**:
  1. 後ろにずらす（+15分刻みで最大+90分）
  2. それでも無理なら前にずらす（-15分刻みで最大-180分）
  3. それでも無理ならランチ枠なし（警告表示）

### 夜ご飯の配置ルール
- **必須**: 20:00〜24:00の間に必ず60分で配置
- **優先順**:
  1. 21:00〜22:00（デフォルト推奨）
  2. 20:30〜21:30
  3. 21:30〜22:30
  4. 20:00〜21:00
  5. 22:00〜23:00
  6. 23:00〜24:00
- **配置不可**: 全て埋まっている場合は警告表示（会食などで代替）

### 家族時間
- **固定**: 20:00〜24:00
- **夜ご飯**: 家族時間の一部として内包

### 返信枠
- **頻度**: 3時間ごと
- **長さ**: 15分
- **配置時間**: 計画開始〜20:00まで

### タスクの配置
- **深い作業**: 45〜90分のタスク
- **軽作業**: 15〜30分のタスク
- **優先度順**: 期限が近い・優先度が高い順に配置
- **空き時間**: 固定予定・食事・返信枠以外の空き時間に配置

## 📱 従来の使い方（タスク管理基本機能）

1. **タスクの追加**
   - タスク名、カテゴリ、優先度、期日、時間を入力
   - 「タスクを追加」ボタンをクリック

2. **タスクの完了**
   - タスクの左側の◯ボタンをクリック
   - 完了したタスクは取り消し線が付きグレーアウト

3. **タスクの削除**
   - タスクの右側のゴミ箱アイコンをクリック
   - 確認ダイアログが表示されます

4. **Googleカレンダーとの連携**
   - 「予定を取得」ボタンをクリック
   - 表示された予定の「タスク化」ボタンをクリック
   - ⚠️ 初回は環境変数の設定が必要です（下記参照）

## ⚙️ 環境変数の設定

Googleカレンダー連携を使用するには、環境変数の設定が必要です。

**👉 詳細な設定手順は [ENV_SETUP.md](ENV_SETUP.md) をご覧ください**

### クイックスタート

**ローカル開発環境**:
1. `.dev.vars`ファイルを編集
2. APIキーとカレンダーIDを設定
3. PM2を再起動

**本番環境**:
```bash
npx wrangler pages secret put GOOGLE_CALENDAR_API_KEY --project-name webapp
npx wrangler pages secret put GOOGLE_CALENDAR_ID --project-name webapp
```

### 必要な環境変数
- `GOOGLE_CALENDAR_API_KEY`: Google Calendar APIキー
- `GOOGLE_CALENDAR_ID`: カレンダーID（通常はGmailアドレス）

## 🛠️ 技術スタック

- **フロントエンド**: HTML, CSS (Tailwind), JavaScript (Vanilla)
- **バックエンド**: Hono (TypeScript)
- **データベース**: Cloudflare D1 (SQLite)
- **デプロイ**: Cloudflare Pages
- **外部API**: Google Calendar API

## 📦 ローカル開発

### 必要なもの
- Node.js 18+
- npm

### セットアップ
```bash
# 依存関係のインストール（既に完了）
npm install

# D1データベースのマイグレーション
npm run db:migrate:local

# テストデータの投入
npm run db:seed

# ビルド
npm run build

# 開発サーバー起動
pm2 start ecosystem.config.cjs

# または
npm run dev:sandbox
```

### 便利なコマンド
```bash
# ポート3000のクリーンアップ
npm run clean-port

# APIテスト
npm run test

# データベースリセット
npm run db:reset

# ログ確認
pm2 logs --nostream

# Gitコミット
npm run git:commit "commit message"
```

## 🌍 デプロイ

### Cloudflare Pagesへのデプロイ

1. **D1データベースの作成**
```bash
npx wrangler d1 create webapp-production
# 出力されたdatabase_idをwrangler.jsoncに設定
```

2. **マイグレーション実行**
```bash
npm run db:migrate:prod
```

3. **Pagesプロジェクト作成**
```bash
npx wrangler pages project create webapp --production-branch main
```

4. **デプロイ**
```bash
npm run deploy:prod
```

5. **環境変数の設定**
```bash
npx wrangler pages secret put GOOGLE_CALENDAR_API_KEY --project-name webapp
npx wrangler pages secret put GOOGLE_CALENDAR_ID --project-name webapp
```

## 🎨 カテゴリと色の対応

| カテゴリ | 色 | 用途 |
|---------|---|------|
| 🟥 未来（最優先） | 赤 | 将来の売上につながる重要な種まき活動 |
| 🟦 直近の売上 | 青 | 今期の売上に直結する活動 |
| 🟩 維持・ルーティン | 緑 | 継続的に行う必要がある定常業務 |
| ⬜ 雑務 | グレー | その他の細かな作業 |

## 📝 次のステップ

1. **GitHubへのプッシュ**
   - リポジトリの作成とコードのプッシュ

2. **自動タスク生成機能の実装**
   - カレンダーイベントから自動的にタスクを生成
   - 定期的な同期処理

3. **フィルター・検索機能**
   - カテゴリ・優先度でのフィルタリング
   - タスク名での検索

4. **統計機能**
   - カテゴリ別の時間配分グラフ
   - 完了率の可視化

5. **通知機能**
   - 期限が近いタスクのリマインダー

## 📄 ライセンス

MIT

## 👤 作者

Your Name

---

最終更新: 2026-02-03
